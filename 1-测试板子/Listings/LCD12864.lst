C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\LCD12864.obj
COMPILER INVOKED BY: D:\Software\Keil_v5\C51\BIN\C51.EXE LCD12864.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\
                    -Listings\LCD12864.lst) OBJECT(.\Objects\LCD12864.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <INTRINS.H>
   3          //引脚配置：
   4          sbit LCD12864_RS=P1^0;
   5          sbit LCD12864_RW=P1^1;
   6          sbit LCD12864_EN=P1^2;
   7          #define LCD12864_DataPort P0
   8          
   9          //函数定义：
  10          /**
  11            * @brief  LCD12864延时函数，11.0592MHz调用可延时1ms
  12            * @param  无
  13            * @retval 无
  14            */
  15          void LCD12864_Delay(unsigned char xms)
  16          {
  17   1              unsigned char i, j;
  18   1              for(;xms>0;xms--){
  19   2                      _nop_();
  20   2                      i = 11;
  21   2                      j = 199;        
  22   2                      do
  23   2                      {
  24   3                              while (--j);
  25   3                      } while (--i);
  26   2              }       
  27   1      }
  28          
  29          void Delay15us()                //@11.0592MHz
  30          {
  31   1              unsigned char i;
  32   1      
  33   1              _nop_();
  34   1              _nop_();
  35   1              i = 38;
  36   1              while (--i);
  37   1      }
  38          
  39          
  40          /**
  41            * @brief  LCD12864写命令
  42            * @param  Command 要写入的命令
  43            * @retval 无
  44            */
  45          void LCD12864_WriteCommand(unsigned char Command)
  46          {
  47   1              LCD12864_RS=0;
  48   1              LCD12864_RW=0;
  49   1              LCD12864_DataPort=Command;
  50   1              LCD12864_EN=1;
  51   1              LCD12864_Delay(1);
  52   1              LCD12864_EN=0;
  53   1              LCD12864_Delay(1);
  54   1      }
C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 2   

  55          
  56          /**
  57            * @brief  LCD12864写数据
  58            * @param  Data 要写入的数据
  59            * @retval 无
  60            */
  61          void LCD12864_WriteData(unsigned char Data)
  62          {
  63   1              LCD12864_RS=1;
  64   1              LCD12864_RW=0;
  65   1              LCD12864_DataPort=Data;
  66   1              LCD12864_EN=1;
  67   1              LCD12864_Delay(1);
  68   1              LCD12864_EN=0;
  69   1              LCD12864_Delay(1);
  70   1      }
  71          
  72          /**
  73            * @brief  LCD12864读数据
  74            * @param  Data 要写出的数据
  75            * @retval 无
  76            */
  77          unsigned char LCD12864_ReadData()
  78          {
  79   1              unsigned char Data = 0;
  80   1              LCD12864_DataPort = 0xff;
  81   1              LCD12864_RS=1;
  82   1              LCD12864_RW=1;
  83   1              LCD12864_EN=1;
  84   1              Delay15us();
  85   1              Data = LCD12864_DataPort;
  86   1              
  87   1              LCD12864_EN=0;
  88   1              LCD12864_Delay(1);
  89   1      
  90   1              return Data;
  91   1      }
  92          
  93          
  94          /**
  95            * @brief  LCD12864设置光标位置
  96            * @param  Line 行位置，范围：1~4
  97            * @param  Column 列位置，范围：1~8
  98            * @retval 无
  99            */
 100          void LCD12864_SetCursor(unsigned char Line,unsigned char Column)
 101          {
 102   1              if(Line==1)
 103   1              {
 104   2                      LCD12864_WriteCommand(0x80+(Column-1));
 105   2              }
 106   1              else if(Line==2)
 107   1              {
 108   2                      LCD12864_WriteCommand(0x90+(Column-1));
 109   2              }
 110   1              else if(Line==3)
 111   1              {
 112   2                      LCD12864_WriteCommand(0x88+(Column-1));
 113   2              }
 114   1              else if(Line==4)
 115   1              {
 116   2                      LCD12864_WriteCommand(0x98+(Column-1));
C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 3   

 117   2              }
 118   1      }
 119          
 120          /**
 121            * @brief  LCD12864初始化函数
 122            * @param  无
 123            * @retval 无
 124            */
 125          void LCD12864_Init()
 126          {         
 127   1              LCD12864_WriteCommand(0x30);   //基本指令集          
 128   1              LCD12864_WriteCommand(0x02);   //地址归位          
 129   1              LCD12864_Delay(5);
 130   1              LCD12864_WriteCommand(0x0c);   //整体显示打开,游标关闭          
 131   1              LCD12864_WriteCommand(0x06);   //游标右移          
 132   1              LCD12864_WriteCommand(0x80);   //设定显示的起始地址          
 133   1              LCD12864_WriteCommand(0x01);   //清除显示 
 134   1              LCD12864_Delay(5);
 135   1      }
 136          
 137          
 138          /**
 139            * @brief  在LCD12864指定位置上显示一个字符
 140            * @param  Line 行位置，范围：1~2
 141            * @param  Column 列位置，范围：1~16
 142            * @param  Char 要显示的字符
 143            * @retval 无
 144            */
 145          void LCD12864_ShowChar(unsigned char Line,unsigned char Column,char Char)
 146          {
 147   1              unsigned char HighData = 0;
 148   1              //不好处理的地址
 149   1              if(Column % 2 == 0){
 150   2                      LCD12864_SetCursor(Line,Column/2);
 151   2                      //first->high
 152   2                      //second->high
 153   2                      //third->low
 154   2                      HighData = LCD12864_ReadData();
 155   2                      //begin write
 156   2                      LCD12864_SetCursor(Line,Column/2);
 157   2                      LCD12864_WriteData(HighData);
 158   2                      LCD12864_WriteData(Char);
 159   2              }
 160   1              //1 3 5 7 9 11 13 15
 161   1              else{
 162   2                      LCD12864_SetCursor(Line,Column/2 + 1);
 163   2                      LCD12864_WriteData(Char);
 164   2              }
 165   1      }
 166          
 167          
 168          /**
 169            * @brief  在LCD12864指定位置开始显示所给字符串
 170            * @param  Line 起始行位置，范围：1~2
 171            * @param  Column 起始列位置，范围：1~16
 172            * @param  String 要显示的字符串
 173            * @retval 无
 174            */
 175          void LCD12864_ShowString(unsigned char Line,unsigned char Column,char *String)
 176          {
 177   1              unsigned char i;
 178   1              unsigned char HighData = 0;
C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 4   

 179   1              //不好处理的地址
 180   1              if(Column % 2 == 0){
 181   2                      LCD12864_SetCursor(Line,Column/2);
 182   2                      HighData = LCD12864_ReadData();
 183   2                      LCD12864_SetCursor(Line,Column/2);
 184   2                      LCD12864_WriteData(HighData);
 185   2                      for(i=0;String[i]!='\0';i++)
 186   2                      {
 187   3                              LCD12864_WriteData(String[i]);
 188   3                      }
 189   2              }
 190   1              //1 3 5 7 9 11 13 15
 191   1              else{
 192   2                      LCD12864_SetCursor(Line,Column/2 + 1);
 193   2                      for(i=0;String[i]!='\0';i++)
 194   2                      {
 195   3                              LCD12864_WriteData(String[i]);
 196   3                      }
 197   2              }
 198   1              
 199   1              
 200   1      }
 201          
 202          /**
 203            * @brief  返回值=X的Y次方
 204            */
 205          int LCD12864_Pow(int X,int Y)
 206          {
 207   1              unsigned char i;
 208   1              int Result=1;
 209   1              for(i=0;i<Y;i++)
 210   1              {
 211   2                      Result*=X;
 212   2              }
 213   1              return Result;
 214   1      }
 215          
 216          /**
 217            * @brief  在LCD12864指定位置开始显示所给数字
 218            * @param  Line 起始行位置，范围：1~4
 219            * @param  Column 起始列位置，范围：1~16
 220            * @param  Number 要显示的数字，范围：0~65535
 221            * @param  Length 要显示数字的长度，范围：1~5
 222            * @retval 无
 223            */
 224          void LCD12864_ShowNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length)
 225          {
 226   1              unsigned char i;
 227   1              unsigned char HighData = 0;
 228   1              //不好处理的地址
 229   1              if(Column % 2 == 0){
 230   2                      LCD12864_SetCursor(Line,Column/2);
 231   2                      HighData = LCD12864_ReadData();
 232   2                      LCD12864_SetCursor(Line,Column/2);
 233   2                      LCD12864_WriteData(HighData);
 234   2                      for(i=Length;i>0;i--)
 235   2                      {
 236   3                              LCD12864_WriteData(Number/LCD12864_Pow(10,i-1)%10+'0');
 237   3                      }
 238   2              }
 239   1              else{
 240   2                      LCD12864_SetCursor(Line,Column/2 + 1);
C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 5   

 241   2                      for(i=Length;i>0;i--)
 242   2                      {
 243   3                              LCD12864_WriteData(Number/LCD12864_Pow(10,i-1)%10+'0');
 244   3                      }
 245   2              }
 246   1      }
 247          
 248          
 249          
 250          /**
 251            * @brief  在LCD12864指定位置开始以有符号十进制显示所给数字
 252            * @param  Line 起始行位置，范围：1~4
 253            * @param  Column 起始列位置，范围：1~16
 254            * @param  Number 要显示的数字，范围：-32768~32767
 255            * @param  Length 要显示数字的长度，范围：1~5
 256            * @retval 无
 257            */
 258          void LCD12864_ShowSignedNum(unsigned char Line,unsigned char Column,int Number,unsigned char Length)
 259          {
 260   1              unsigned char i;
 261   1              unsigned int Number1;
 262   1              unsigned char HighData = 0;
 263   1      
 264   1              //不好处理的地址
 265   1              if(Column % 2 == 0){
 266   2                      LCD12864_SetCursor(Line,Column/2);
 267   2                      HighData = LCD12864_ReadData();
 268   2                      LCD12864_SetCursor(Line,Column/2);
 269   2                      LCD12864_WriteData(HighData);
 270   2                      if(Number>=0)
 271   2                      {
 272   3                              LCD12864_WriteData('+');
 273   3                              Number1=Number;
 274   3                      }
 275   2                      else
 276   2                      {
 277   3                              LCD12864_WriteData('-');
 278   3                              Number1=-Number;
 279   3                      }
 280   2                      for(i=Length;i>0;i--)
 281   2                      {
 282   3                              LCD12864_WriteData(Number1/LCD12864_Pow(10,i-1)%10+'0');
 283   3                      }
 284   2              }
 285   1              else{
 286   2                      LCD12864_SetCursor(Line,Column/2 + 1);
 287   2                      if(Number>=0)
 288   2                      {
 289   3                              LCD12864_WriteData('+');
 290   3                              Number1=Number;
 291   3                      }
 292   2                      else
 293   2                      {
 294   3                              LCD12864_WriteData('-');
 295   3                              Number1=-Number;
 296   3                      }
 297   2                      for(i=Length;i>0;i--)
 298   2                      {
 299   3                              LCD12864_WriteData(Number1/LCD12864_Pow(10,i-1)%10+'0');
 300   3                      }
 301   2              }
 302   1      
C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 6   

 303   1              
 304   1              
 305   1      }
 306          
 307          /**
 308            * @brief  在LCD12864指定位置开始以十六进制显示所给数字
 309            * @param  Line 起始行位置，范围：1~2
 310            * @param  Column 起始列位置，范围：1~16
 311            * @param  Number 要显示的数字，范围：0~0xFFFF
 312            * @param  Length 要显示数字的长度，范围：1~4
 313            * @retval 无
 314            */
 315          void LCD12864_ShowHexNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length)
 316          {
 317   1              unsigned char i,SingleNumber;
 318   1              unsigned char HighData = 0;
 319   1              //不好处理的地址
 320   1              if(Column % 2 == 0){
 321   2                      LCD12864_SetCursor(Line,Column/2);
 322   2                      HighData = LCD12864_ReadData();
 323   2                      LCD12864_SetCursor(Line,Column/2);
 324   2                      LCD12864_WriteData(HighData);
 325   2                      for(i=Length;i>0;i--)
 326   2                      {
 327   3                              SingleNumber=Number/LCD12864_Pow(16,i-1)%16;
 328   3                              if(SingleNumber<10)
 329   3                              {
 330   4                                      LCD12864_WriteData(SingleNumber+'0');
 331   4                              }
 332   3                              else
 333   3                              {
 334   4                                      LCD12864_WriteData(SingleNumber-10+'A');
 335   4                              }
 336   3                      }
 337   2              }
 338   1              else{
 339   2                      LCD12864_SetCursor(Line,Column/2 + 1);
 340   2                      for(i=Length;i>0;i--)
 341   2                      {
 342   3                              SingleNumber=Number/LCD12864_Pow(16,i-1)%16;
 343   3                              if(SingleNumber<10)
 344   3                              {
 345   4                                      LCD12864_WriteData(SingleNumber+'0');
 346   4                              }
 347   3                              else
 348   3                              {
 349   4                                      LCD12864_WriteData(SingleNumber-10+'A');
 350   4                              }
 351   3                      }
 352   2              }
 353   1              
 354   1      }
 355          
 356          /**
 357            * @brief  在LCD12864指定位置开始以二进制显示所给数字
 358            * @param  Line 起始行位置，范围：1~2
 359            * @param  Column 起始列位置，范围：1~16
 360            * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111
 361            * @param  Length 要显示数字的长度，范围：1~16
 362            * @retval 无
 363            */
 364          void LCD12864_ShowBinNum(unsigned char Line,unsigned char Column,unsigned int Number,unsigned char Length)
C51 COMPILER V9.60.0.0   LCD12864                                                          05/10/2021 21:01:37 PAGE 7   

 365          {
 366   1              unsigned char i;
 367   1              unsigned char HighData = 0;
 368   1              //不好处理的地址
 369   1              if(Column % 2 == 0){
 370   2                      LCD12864_SetCursor(Line,Column/2);
 371   2                      HighData = LCD12864_ReadData();
 372   2                      LCD12864_SetCursor(Line,Column/2);
 373   2                      LCD12864_WriteData(HighData);
 374   2                      for(i=Length;i>0;i--)
 375   2                      {
 376   3                              LCD12864_WriteData(Number/LCD12864_Pow(2,i-1)%2+'0');
 377   3                      }
 378   2              }
 379   1              else{
 380   2                      LCD12864_SetCursor(Line,Column/2 + 1);
 381   2                      for(i=Length;i>0;i--)
 382   2                      {
 383   3                              LCD12864_WriteData(Number/LCD12864_Pow(2,i-1)%2+'0');
 384   3                      }
 385   2              }
 386   1              
 387   1      }
 388          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1056    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      37
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
