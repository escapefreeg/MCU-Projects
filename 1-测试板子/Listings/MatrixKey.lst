C51 COMPILER V9.60.0.0   MATRIXKEY                                                         05/10/2021 20:49:26 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MATRIXKEY
OBJECT MODULE PLACED IN .\Objects\MatrixKey.obj
COMPILER INVOKED BY: D:\Software\Keil_v5\C51\BIN\C51.EXE MatrixKey.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\MatrixKey.lst) OBJECT(.\Objects\MatrixKey.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          unsigned char MatrixKey_FreshKey = 0;
   4          
   5          /**
   6            * @brief  矩阵键盘返回最新鲜的Key值，取后清0,相当与从缓存中取值
   7            * @param  无
   8            * @retval 最新鲜的Key值
   9            */
  10          unsigned char MatrixKey(){
  11   1              unsigned char Temp = 0;
  12   1              Temp = MatrixKey_FreshKey;
  13   1              MatrixKey_FreshKey = 0;
  14   1              return Temp;
  15   1      }
  16          
  17          /**
  18            * @brief  矩阵键盘读取按键键码
  19            * @param  无
  20            * @retval KeyNumber 按下按键的键码值
  21            */
  22          unsigned char MatrixKey_Scan()
  23          {
  24   1              unsigned char KeyNumber=0;
  25   1              
  26   1              P3=0xFF;
  27   1              P3_0=0;
  28   1                   if(P3_7==0){KeyNumber=4;}
  29   1              else if(P3_6==0){KeyNumber=3;}
  30   1              else if(P3_5==0){KeyNumber=2;}
  31   1              else if(P3_4==0){KeyNumber=1;}
  32   1              
  33   1              P3=0xFF;
  34   1              P3_1=0;
  35   1                   if(P3_7==0){KeyNumber=8;}
  36   1              else if(P3_6==0){KeyNumber=7;}
  37   1              else if(P3_5==0){KeyNumber=6;}
  38   1              else if(P3_4==0){KeyNumber=5;}
  39   1              
  40   1              P3=0xFF;
  41   1              P3_2=0;
  42   1                   if(P3_7==0){KeyNumber=12;}
  43   1              else if(P3_6==0){KeyNumber=11;}
  44   1              else if(P3_5==0){KeyNumber=10;}
  45   1              else if(P3_4==0){KeyNumber=9;}
  46   1              
  47   1              P3=0xFF;
  48   1              P3_3=0;
  49   1                   if(P3_7==0){KeyNumber=16;}
  50   1              else if(P3_6==0){KeyNumber=15;}
  51   1              else if(P3_5==0){KeyNumber=14;}
  52   1              else if(P3_4==0){KeyNumber=13;}
  53   1              
  54   1              return KeyNumber;
C51 COMPILER V9.60.0.0   MATRIXKEY                                                         05/10/2021 20:49:26 PAGE 2   

  55   1      }
  56          
  57          /**
  58            * @brief  矩阵键盘读取按键键码
  59            * @param  无
  60            * @retval KeyNumber 按下按键的键码值(利用定时扫描实现)
  61                                  松手的一瞬间，返回按键键码，没有按键按下时，返回0
  62            */
  63          
  64          void MatrixKey_Loop(){
  65   1              static unsigned char LastStatus,NowStatus;
  66   1              LastStatus = NowStatus;
  67   1              NowStatus = MatrixKey_Scan();
  68   1                       if(LastStatus == 1 && NowStatus == 0) MatrixKey_FreshKey = 1;
  69   1              else if(LastStatus == 2 && NowStatus == 0) MatrixKey_FreshKey = 2;
  70   1              else if(LastStatus == 3 && NowStatus == 0) MatrixKey_FreshKey = 3;
  71   1              else if(LastStatus == 4 && NowStatus == 0) MatrixKey_FreshKey = 4;
  72   1              else if(LastStatus == 5 && NowStatus == 0) MatrixKey_FreshKey = 5;
  73   1              else if(LastStatus == 6 && NowStatus == 0) MatrixKey_FreshKey = 6;
  74   1              else if(LastStatus == 7 && NowStatus == 0) MatrixKey_FreshKey = 7;
  75   1              else if(LastStatus == 8 && NowStatus == 0) MatrixKey_FreshKey = 8;
  76   1              else if(LastStatus == 9 && NowStatus == 0) MatrixKey_FreshKey = 9;
  77   1              else if(LastStatus == 10 && NowStatus == 0) MatrixKey_FreshKey = 10;
  78   1              else if(LastStatus == 11 && NowStatus == 0) MatrixKey_FreshKey = 11;
  79   1              else if(LastStatus == 12 && NowStatus == 0) MatrixKey_FreshKey = 12;
  80   1              else if(LastStatus == 13 && NowStatus == 0) MatrixKey_FreshKey = 13;
  81   1              else if(LastStatus == 14 && NowStatus == 0) MatrixKey_FreshKey = 14;
  82   1              else if(LastStatus == 15 && NowStatus == 0) MatrixKey_FreshKey = 15;
  83   1              else if(LastStatus == 16 && NowStatus == 0) MatrixKey_FreshKey = 16;
  84   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    377    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
